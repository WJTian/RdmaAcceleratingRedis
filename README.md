# RdmaAcceleratingRedis

## 1 背景

Redis本身自带了集群实现方案，通过修改Redis中的配置文件并执行脚本可以将几台独立的Redis服务器组合成一个集群对外提供服务。当我们以集群模式运行redis-cli，或者在其他语言中使用更加简单的方式使用客户端访问Redis集群（比如Jedis），当我们执行set命令向集群中添加一对键值时，程序将这对键值存放在集群的其中一台服务上，也就是说执行set时，这对键值在系统中只存在一份；当我们执行get命令从集群获取一个key对应的值时，程序帮我们找到这个key所在Redis服务器的，并将value返回给客户端。

我们发现，在上面所描述的Redis集群方案有一些值得考虑的地方，比如：

1. 不管集群由多少台机器组成，一对key-value在系统中只存在一份。对于一些应用来说，热点数据可能是非常集中的，大量的客户端总是访问少量的热点数据。Redis集群并不能解决这样的问题，因为热点数据在集群中也只有一份。
2. 我们知道Redis服务是单线程的，这意味着Redis服务器只能在响应一个客户端的请求之后才继续请求下一个客户端的请求。Redis集群在执行客户端get指令的时候，如果当前响应客户端的Redis服务器中不存在指定的key，那么这个Redis服务器会重定向到存在key的Redis服务器上。也就是说，当客户端请求的是同一个key的时候，Redis集群将这些请求都转发给存在key的服务器来处理，造成单个服务器的压力过大。

我们的目的是使用RDMA优化Redis现有的集群方案，我们的主要工作如下：

1. 我们改变了现有的集群方案，我们希望一个Redis集群中所有的Redis服务器的数据是完全同步的，每台Redis服务器都可以完全独立、对等的对外提供服务。这样，在遇到前面我们描述的应用场景是，Redis集群可以提供更好的性能。我们设计了测试用例，比较了高负载情况下，Redis自带的集群与我们的集群方案的性能。
2. 我们利用RDMA设计了一个Redis集群中所有Redis服务器数据同步的程序，与使用Socket进行同步的程序进行了性能上的比较。
3. 我们尝试用一个上层的RDMA库rsocket替换Redis中已有的socket通信代码。



## 2 应用场景

我们的应用场景分为两个：



## 3 环境搭建



## 4 测试结果